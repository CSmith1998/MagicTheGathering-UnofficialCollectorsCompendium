@using Microsoft.AspNetCore.Identity;
@using MtG_UCC.Models.Database;
@using MtG_UCC.Models.Microsoft_Identity;
@model List<UsersWithRoles>

<table class="table">
    <thead>
        <tr>
            <th>User ID</th>
            <th>Username</th>
            <th>Role</th>
            <th>Edit Role</th>
        </tr>
    </thead>
    <tbody>
        @foreach(var item in Model) {
            await Html.RenderPartialAsync("_UserPartial", item, ViewData);
        }
    </tbody>
</table>

<!-- Add the confirmation modal dialog -->
@*<div class="modal" tabindex="-1" role="dialog" id="confirmationModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Deletion</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this user?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDelete">Confirm</button>
            </div>
        </div>
    </div>
</div>*@


@*<script>
    // JavaScript to handle the form submission and AJAX
    $(document).ready(function () {
        let userIdToDelete; // Variable to store the UserId to delete

        // Event listener for the Delete button click
        $('.delete-button').on('click', function () {
            userIdToDelete = $(this).data('userid'); // Get the UserId from data attribute
            $('#confirmationModal').modal('show'); // Show the confirmation modal
        });

        // Event listener for the Confirm Delete button click
        $('#confirmDelete').on('click', function (e) {
            e.preventDefault(); // Prevent the default form submission

            $('#confirmationModal').modal('hide'); // Hide the confirmation modal

            // Perform the delete action using AJAX
            $.ajax({
                type: 'POST',
                url: '@Url.Action("DeleteUser", "Admin")',
                data: { userId: userIdToDelete },
                success: function (result) {
                    // Handle the success response if needed
                    // For example, you can reload the user list to reflect the changes
                    location.reload(); // This will refresh the page to update the user list
                },
                error: function (xhr, status, error) {
                    // Handle the error response if needed
                    console.log(xhr.responseText); // Log the error to the console for debugging
                    alert('An error occurred while deleting the user.');
                }
            });
        });
    });
</script>*@
